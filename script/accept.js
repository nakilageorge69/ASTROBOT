const moment = require("moment-timezone");

let autoAccept = true;

module.exports.config = {
  name: "accept",
  version: "1.0.0",
  hasPermssion: 2,
  credits: "GeoDevz69",
  description: "Make friends via Facebook ID",
  commandCategory: "admin",
  usages: "uid",
  cooldowns: 0
};

module.exports.run = async ({ event, api }) => {
  const form = {
    av: api.getCurrentUserID(),
    fb_api_req_friendly_name: "FriendingCometFriendRequestsRootQueryRelayPreloader",
    fb_api_caller_class: "RelayModern",
    doc_id: "4499164963466303",
    variables: JSON.stringify({ input: { scale: 3 } })
  };
  const listRequest = JSON.parse(await api.httpPost("https://www.facebook.com/api/graphql/", form)).data.viewer.friending_possibilities.edges;

  const args = event.body.split(" ");
  if (args.length >= 2) {
    if (args[1].toLowerCase() === "on") {
      autoAccept = true;
      return api.sendMessage("â•­â”€ã€ ğ—”ğ—–ğ—–ğ—˜ğ—£ğ—§ ã€âœ§âœ§âœ§\nâ•°âœ§âœ§âœ§â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\nâ•­âœ§âœ§âœ§â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\nğ™ğ™šğ™¨ğ™¥ğ™¤ğ™£ğ™¨ğ™š: Auto-accept is now turned on.\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§âœ§âœ§\nâ—‰ ğšğ™´ğ™¿ğ™»ğšˆ 'ğš„ğ™½ğš‚ğ™´ğ™½ğ™³' ğšƒğ™¾ ğšğ™´ğ™¼ğ™¾ğš…ğ™´ ğšƒğ™·ğ™´ ğ™°ğ™¸'ğšœ ğšğ™´ğš‚ğ™¿ğ™¾ğ™½ğš‚ğ™´.\nâ—‰  ğšƒğ™·ğ™´ğš‚ğ™´ ğ™²ğ™¾ğ™¼ğ™¼ğ™°ğ™½ğ™³ğš‚ ğ™µğ™¾ğš ğ™°ğ™³ğ™¼ğ™¸ğ™½ ğ™¾ğ™½ğ™»ğšˆ!\nâ•­âœ§âœ§âœ§â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\n    Â»ğ™²ğ™¾ğ™½ğšƒğ™°ğ™²ğšƒ ğ™°ğ™¸ ğ™¾ğš†ğ™½ğ™´ğšÂ«\nhttps://www.facebook.com/geotechph.net\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§âœ§âœ§", event.threadID);
    } else if (args[1].toLowerCase() === "off") {
      autoAccept = false;
      return api.sendMessage("â•­â”€ã€ ğ—”ğ—–ğ—–ğ—˜ğ—£ğ—§ ã€âœ§âœ§âœ§\nâ•°âœ§âœ§âœ§â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\nâ•­âœ§âœ§âœ§â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\nğ™ğ™šğ™¨ğ™¥ğ™¤ğ™£ğ™¨ğ™š: Auto-accept is now turned off.\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§âœ§âœ§\nâ—‰ ğšğ™´ğ™¿ğ™»ğšˆ 'ğš„ğ™½ğš‚ğ™´ğ™½ğ™³' ğšƒğ™¾ ğšğ™´ğ™¼ğ™¾ğš…ğ™´ ğšƒğ™·ğ™´ ğ™°ğ™¸'ğšœ ğšğ™´ğš‚ğ™¿ğ™¾ğ™½ğš‚ğ™´.\nâ—‰  ğšƒğ™·ğ™´ğš‚ğ™´ ğ™²ğ™¾ğ™¼ğ™¼ğ™°ğ™½ğ™³ğš‚ ğ™µğ™¾ğš ğ™°ğ™³ğ™¼ğ™¸ğ™½ ğ™¾ğ™½ğ™»ğšˆ!\nâ•­âœ§âœ§âœ§â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\n    Â»ğ™²ğ™¾ğ™½ğšƒğ™°ğ™²ğšƒ ğ™°ğ™¸ ğ™¾ğš†ğ™½ğ™´ğšÂ«\nhttps://www.facebook.com/geotechph.net\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§âœ§âœ§", event.threadID);
    }
  }

  if (autoAccept) {
    // Implement auto-accept logic here
    const success = [];
    const failed = [];

    for (const user of listRequest) {
      const u = user.node;
      form.fb_api_req_friendly_name = "FriendingCometFriendRequestConfirmMutation";
      form.doc_id = "3147613905362928";
      form.variables.input.friend_requester_id = u.id;
      form.variables = JSON.stringify(form.variables);

      try {
        const friendRequest = await api.httpPost("https://www.facebook.com/api/graphql/", form);
        if (!JSON.parse(friendRequest).errors) {
          success.push(u.name);
        }
      } catch (e) {
        failed.push(u.name);
      }

      form.variables = JSON.parse(form.variables);
    }

    api.sendMessage(`â•­â”€ã€ ğ—”ğ—–ğ—–ğ—˜ğ—£ğ—§ ã€âœ§âœ§âœ§\nâ•°âœ§âœ§âœ§â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\nâ•­âœ§âœ§âœ§â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\nğ™ğ™šğ™¨ğ™¥ğ™¤ğ™£ğ™¨ğ™š: Auto-accepted ${success.length} friend requests:\n${success.join("\n")}${failed.length > 0 ? `\nFailed to accept with ${failed.length} person: ${failed.join("\n")}` : ""}\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§âœ§âœ§\nâ—‰ ğšğ™´ğ™¿ğ™»ğšˆ 'ğš„ğ™½ğš‚ğ™´ğ™½ğ™³' ğšƒğ™¾ ğšğ™´ğ™¼ğ™¾ğš…ğ™´ ğšƒğ™·ğ™´ ğ™°ğ™¸'ğšœ ğšğ™´ğš‚ğ™¿ğ™¾ğ™½ğš‚ğ™´.\nâ—‰  ğšƒğ™·ğ™´ğš‚ğ™´ ğ™²ğ™¾ğ™¼ğ™¼ğ™°ğ™½ğ™³ğš‚ ğ™µğ™¾ğš ğ™°ğ™³ğ™¼ğ™¸ğ™½ ğ™¾ğ™½ğ™»ğšˆ!\nâ•­âœ§âœ§âœ§â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\n    Â»ğ™²ğ™¾ğ™½ğšƒğ™°ğ™²ğšƒ ğ™°ğ™¸ ğ™¾ğš†ğ™½ğ™´ğšÂ«\nhttps://www.facebook.com/geotechph.net\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§âœ§âœ§`, event.threadID);
  } else {
    api.sendMessage("â•­â”€ã€ ğ—”ğ—–ğ—–ğ—˜ğ—£ğ—§ ã€âœ§âœ§âœ§\nâ•°âœ§âœ§âœ§â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\nâ•­âœ§âœ§âœ§â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\nğ™ğ™šğ™¨ğ™¥ğ™¤ğ™£ğ™¨ğ™š: Auto-accept is currently turned off.\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§âœ§âœ§\nâ—‰ ğšğ™´ğ™¿ğ™»ğšˆ 'ğš„ğ™½ğš‚ğ™´ğ™½ğ™³' ğšƒğ™¾ ğšğ™´ğ™¼ğ™¾ğš…ğ™´ ğšƒğ™·ğ™´ ğ™°ğ™¸'ğšœ ğšğ™´ğš‚ğ™¿ğ™¾ğ™½ğš‚ğ™´.\nâ—‰  ğšƒğ™·ğ™´ğš‚ğ™´ ğ™²ğ™¾ğ™¼ğ™¼ğ™°ğ™½ğ™³ğš‚ ğ™µğ™¾ğš ğ™°ğ™³ğ™¼ğ™¸ğ™½ ğ™¾ğ™½ğ™»ğšˆ!\nâ•­âœ§âœ§âœ§â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§\n    Â»ğ™²ğ™¾ğ™½ğšƒğ™°ğ™²ğšƒ ğ™°ğ™¸ ğ™¾ğš†ğ™½ğ™´ğšÂ«\nhttps://www.facebook.com/geotechph.net\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ§âœ§âœ§", event.threadID);
  }
};
